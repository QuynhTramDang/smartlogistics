# silver_config/outbound_delivery.py

from pyspark.sql.types import StructType, StructField, StringType, BooleanType, ArrayType
from silver.common import make_raw_path, DELTA_BASE, REJECT_BASE, LOGGING_BASE, MARKER_BASE

#  OUTBOUND_DELIVERY_HEADER
OUTBOUND_DELIVERY_HEADER_CONFIG = {
    "job_name": "outbound_delivery_header",
    "raw_path": make_raw_path("outbound_delivery_header"),
    "delta_path": f"{DELTA_BASE}/outbound_delivery_header",
    "reject_path": f"{REJECT_BASE}/outbound_delivery_header",
    "log_path": f"{LOGGING_BASE}/outbound_delivery_header",
    "marker_path": f"{MARKER_BASE}/outbound_delivery_header",
    "use_file_marker": True,
    "key_columns": ["DeliveryDocument"],
    "required_columns": ["DeliveryDocument"],
    "partition_by": ["CreationDate"],
    "table_type": "fact",
    "flatten_expr": "explode(d.results) as record",

    "data_quality_rules": {
        "ActualGoodsMovementDate": ["odata_date"],
        "BillingDocumentDate": ["odata_date"],
        "CreationDate": ["odata_date"],
        "DeliveryDate": ["odata_date"],
        "DocumentDate": ["odata_date"],
        "IntercompanyBillingDate": ["odata_date"],
        "LastChangeDate": ["odata_date"],
        "LoadingDate": ["odata_date"],
        "PickingDate": ["odata_date"],
        "PlannedGoodsIssueDate": ["odata_date"],
        "ProofOfDeliveryDate": ["odata_date"],
        "TransportationPlanningDate": ["odata_date"]
    },

    "schema": StructType([
        StructField("d", StructType([
            StructField("results", ArrayType(StructType([
                StructField("ActualDeliveryRoute", StringType()),
                StructField("Shippinglocationtimezone", StringType()),
                StructField("ActualGoodsMovementDate", StringType()),
                StructField("Receivinglocationtimezone", StringType()),
                StructField("ActualGoodsMovementTime", StringType()),
                StructField("BillingDocumentDate", StringType()),
                StructField("BillOfLading", StringType()),
                StructField("CompleteDeliveryIsDefined", BooleanType()),
                StructField("ConfirmationTime", StringType()),
                StructField("CreatedByUser", StringType()),
                StructField("CreationDate", StringType()),
                StructField("CreationTime", StringType()),
                StructField("CustomerGroup", StringType()),
                StructField("DeliveryBlockReason", StringType()),
                StructField("DeliveryDate", StringType()),
                StructField("DeliveryDocument", StringType()),
                StructField("DeliveryDocumentBySupplier", StringType()),
                StructField("DeliveryDocumentType", StringType()),
                StructField("DeliveryIsInPlant", BooleanType()),
                StructField("DeliveryPriority", StringType()),
                StructField("DeliveryTime", StringType()),
                StructField("DeliveryVersion", StringType()),
                StructField("DepreciationPercentage", StringType()),
                StructField("DistrStatusByDecentralizedWrhs", StringType()),
                StructField("DocumentDate", StringType()),
                StructField("ExternalIdentificationType", StringType()),
                StructField("ExternalTransportSystem", StringType()),
                StructField("FactoryCalendarByCustomer", StringType()),
                StructField("GoodsIssueOrReceiptSlipNumber", StringType()),
                StructField("GoodsIssueTime", StringType()),
                StructField("HandlingUnitInStock", StringType()),
                StructField("HdrGeneralIncompletionStatus", StringType()),
                StructField("HdrGoodsMvtIncompletionStatus", StringType()),
                StructField("HeaderBillgIncompletionStatus", StringType()),
                StructField("HeaderBillingBlockReason", StringType()),
                StructField("HeaderDelivIncompletionStatus", StringType()),
                StructField("HeaderGrossWeight", StringType()),
                StructField("HeaderNetWeight", StringType()),
                StructField("HeaderPackingIncompletionSts", StringType()),
                StructField("HeaderPickgIncompletionStatus", StringType()),
                StructField("HeaderVolume", StringType()),
                StructField("HeaderVolumeUnit", StringType()),
                StructField("HeaderWeightUnit", StringType()),
                StructField("IncotermsClassification", StringType()),
                StructField("IncotermsTransferLocation", StringType()),
                StructField("IntercompanyBillingDate", StringType()),
                StructField("InternalFinancialDocument", StringType()),
                StructField("IsDeliveryForSingleWarehouse", StringType()),
                StructField("IsExportDelivery", StringType()),
                StructField("LastChangeDate", StringType()),
                StructField("LastChangedByUser", StringType()),
                StructField("LoadingDate", StringType()),
                StructField("LoadingPoint", StringType()),
                StructField("LoadingTime", StringType()),
                StructField("MeansOfTransport", StringType()),
                StructField("MeansOfTransportRefMaterial", StringType()),
                StructField("MeansOfTransportType", StringType()),
                StructField("OrderCombinationIsAllowed", BooleanType()),
                StructField("OrderID", StringType()),
                StructField("OverallDelivConfStatus", StringType()),
                StructField("OverallDelivReltdBillgStatus", StringType()),
                StructField("OverallGoodsMovementStatus", StringType()),
                StructField("OverallIntcoBillingStatus", StringType()),
                StructField("OverallPackingStatus", StringType()),
                StructField("OverallPickingConfStatus", StringType()),
                StructField("OverallPickingStatus", StringType()),
                StructField("OverallProofOfDeliveryStatus", StringType()),
                StructField("OverallSDProcessStatus", StringType()),
                StructField("OverallWarehouseActivityStatus", StringType()),
                StructField("OvrlItmDelivIncompletionSts", StringType()),
                StructField("OvrlItmGdsMvtIncompletionSts", StringType()),
                StructField("OvrlItmGeneralIncompletionSts", StringType()),
                StructField("OvrlItmPackingIncompletionSts", StringType()),
                StructField("OvrlItmPickingIncompletionSts", StringType()),
                StructField("PaymentGuaranteeProcedure", StringType()),
                StructField("PickedItemsLocation", StringType()),
                StructField("PickingDate", StringType()),
                StructField("PickingTime", StringType()),
                StructField("PlannedGoodsIssueDate", StringType()),
                StructField("ProofOfDeliveryDate", StringType()),
                StructField("ProposedDeliveryRoute", StringType()),
                StructField("ReceivingPlant", StringType()),
                StructField("RouteSchedule", StringType()),
                StructField("SalesDistrict", StringType()),
                StructField("SalesOffice", StringType()),
                StructField("SalesOrganization", StringType()),
                StructField("SDDocumentCategory", StringType()),
                StructField("ShipmentBlockReason", StringType()),
                StructField("ShippingCondition", StringType()),
                StructField("ShippingPoint", StringType()),
                StructField("ShippingType", StringType()),
                StructField("ShipToParty", StringType()),
                StructField("SoldToParty", StringType()),
                StructField("SpecialProcessingCode", StringType()),
                StructField("StatisticsCurrency", StringType()),
                StructField("Supplier", StringType()),
                StructField("TotalBlockStatus", StringType()),
                StructField("TotalCreditCheckStatus", StringType()),
                StructField("TotalNumberOfPackage", StringType()),
                StructField("TransactionCurrency", StringType()),
                StructField("TransportationGroup", StringType()),
                StructField("TransportationPlanningDate", StringType()),
                StructField("TransportationPlanningStatus", StringType()),
                StructField("TransportationPlanningTime", StringType()),
                StructField("UnloadingPointName", StringType()),
                StructField("Warehouse", StringType()),
                StructField("WarehouseGate", StringType()),
                StructField("WarehouseStagingArea", StringType())
            ])))
        ]))
    ])
}
